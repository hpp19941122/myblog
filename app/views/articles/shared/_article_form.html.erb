<div class="form-group" style="margin-bottom: 0px;">
  <div class="col-lg-3">
    <label class="form_label"><%= t("article.title") %></label>
  </div>
</div>
<div class="form-group">
  <div class="col-lg-2">
    <%= select_tag(:source_type, show_article_source_type_select, class: "form-control")%>
  </div>
  <div class="col-lg-7">
    <input type="text" class="form-control" name="title">
  </div>
</div>

<div class="form-group" style="padding-left: 15px; padding-right: 15px;">
  <%= kindeditor_tag :content %>
</div>

<div class="form-group">
  <div class="col-lg-5">
    <label><%= t('article.attachment') %></label>
    <input type="file" name='attachment' class="form-control">
  </div>
</div>

<div class="form-group" style="margin-bottom: 0px;">
  <div class="col-lg-12">
    <label class="form_label"><%= t("article.category") %></label>
  </div>
</div>

<div class="form-group">
  <div class="col-lg-12">
    <% if @categories.present? %>
      <% @categories.each do |category| %>
        <div class="radio checkbox-inline" style="padding-top: 0px; padding-left: 0px;">
          <label><input type="radio" name="category"  value="<%= category['id'] %>"><%= category['name'] %></label>
        </div>
      <% end %>
    <% end %>
  </div>
</div>

<div class="form-group" style="margin-bottom: 0px;">
  <div class="col-lg-12">
    <label class="form_label"><%= t("article.tags") %></label>
  </div>
</div>
<div class="form-group">
  <div class="col-lg-12 tags_checkbox_list">
    <%= render :partial => "articles/shared/tags_checkbox_list", locals: {tags: @tags} %>
  </div>
</div>

<div class="form-group">
  <div class="col-lg-12">
    <label class="form_label"><%= t("article.summary") %></label>
    <textarea class="form-control" name='summary' rows="3"></textarea>
  </div>
</div>

<div class="form-group">
  <div class="col-lg-6">
    <label class="form_label"><%= t("article.source") %></label>
    <input type="text" class="form-control" name="source">
  </div>
  <div class="col-lg-6">
    <label class="form_label"><%= t("article.source_url") %></label>
    <input type="text" class="form-control" name="source_url">
  </div>
</div>

<div class="form-group" style="margin-bottom: 40px; margin-top: 35px;">
  <div class="col-sm-offset-10" style="display: inline;">
    <button type="button" class="btn btn-primary article_preview_btn" style="margin-right: 20px;"><%= t('article.preview') %></button>
    <button type="submit" class="btn btn-primary article_save_btn"><%= t('button.save') %></button>
  </div>
</div>

<script type="text/javascript">
  $(function(){
    $articleForm = $("form[name='article_form'");

    var empty_validator = {
      validators: {
        notEmpty: {message: '不能为空'}
      }
    };

    $articleForm.bootstrapValidator({
      feedbackIcons: {
        valid: 'glyphicon glyphicon-ok',
        invalid: 'glyphicon glyphicon-remove',
        validating: 'glyphicon glyphicon-refresh'
      },
      fields: {
        title: empty_validator,
        category: empty_validator,
        summary: empty_validator,
        'tags[]': {
          validators: {
            choice: {
              min: 1,
              message: '不能为空'
            }
          }
        }
      }
    });

    $('.article_save_btn').click(function() {
      $articleForm.bootstrapValidator('validate')
      if(!$articleForm.data('bootstrapValidator').isValid()){
        return;
      }
      $articleForm.submit()
    })

    $('.article_preview_btn').click(function() {
      $articleForm.bootstrapValidator('validate')
      if(!$articleForm.data('bootstrapValidator').isValid()){
        return;
      }
      var data = $articleForm.serialize();
      console.log(data)
      window.open("/articles/preview?"+data)
    })
  })
</script>
