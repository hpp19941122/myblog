<div class="form-group" style="margin-bottom: 0;">
  <div class="col-lg-12">
    <label class="form_label"><%= t("article.title") %></label>
  </div>
</div>

<div class="form-group">
  <div class="col-lg-12">
    <%= f.text_field :title, class: 'form-control' %>
  </div>
</div>

<div class="form-group">
  <div class="col-lg-12">
    <label class="form_label"><%= t("article.summary") %></label>
    <%= f.text_area :summary, class: 'form-control', style: "resize:none;", rows: 2 %>
  </div>
</div>

<div class="form-group markdown-container">
  <div class="col-lg-12">
    <div class="toolbar-wrapper"></div>
  </div>
  <div class="markdown col-lg-12">
    <div class="editor">
      <%= f.text_area :content, class: 'form-control', style: "resize:none;", rows: 20 %>
    </div>
    <!--<div class="show" hidden></div>-->
  </div>
</div>

<div class="form-group" style="margin-bottom: 0;">
  <div class="col-lg-12">
    <label class="form_label"><%= t("article.category") %></label>
  </div>
</div>

<div class="form-group">
  <div class="col-lg-12">
    <% get_categories.each do |category| %>
      <div class="radio checkbox-inline" style="padding-top: 0px; padding-left: 0px;">
        <label>
          <%= f.radio_button(:category_id, category['id']) %>
          <%= category['name'] %>
        </label>
      </div>
    <% end %>
  </div>
</div>

<div class="form-group" style="margin-bottom: 0;">
  <div class="col-lg-2">
    <label class="form_label"><%= t("article.source_type_name") %></label>
  </div>
  <div class="col-lg-10">
    <label class="form_label"><%= t("article.tags") %></label>
  </div>
</div>

<div class="form-group">
  <div class="col-lg-2">
    <%= f.select(:source_type, article_source_type_select_options, {}, {class: 'form-control'}) %>
  </div>

  <div class="col-lg-10">
    <%= f.text_field :tags, class: 'form-control' %>
  </div>
</div>

<div class="form-group">
  <div class="col-lg-6">
    <label class="form_label"><%= t("article.source") %></label>
    <%= f.text_field :source, class: 'form-control' %>
  </div>
  <div class="col-lg-6">
    <label class="form_label"><%= t("article.source_url") %></label>
    <%= f.text_field :source_url, class: 'form-control' %>
  </div>
</div>

<div class="form-group">
  <div class="pull-right" style="padding-right: 15px;">
    <%= f.submit t('button.save'), class: "btn btn-primary article_save_btn"%>
  </div>
</div>

<script type="text/javascript">
  $(function(){
    var $articleForm = $("#article_form");

    $articleForm.bootstrapValidator({
      feedbackIcons: {
        valid: 'glyphicon glyphicon-ok',
        invalid: 'glyphicon glyphicon-remove',
        validating: 'glyphicon glyphicon-refresh'
      },
      fields: {
        'article[title]': {
          validators: {
            notEmpty: {message: '不能为空'},
            stringLength:{max: 64, message: '最大长度为64！'}
          }
        },
        'article[category_id]': {
          validators: {
            notEmpty: {message: '不能为空'}
          }
        },
        'article[summary]': {
          validators: {
            stringLength:{max: 255, message: '最大长度为255！'}
          }
        },
        'article[tags]': {
          validators: {
            notEmpty: {message: '不能为空'},
            stringLength:{max: 32, message: '最大长度为32！'}
          }
        },
        'article[source]': {
          validators: {
            stringLength:{max: 64, message: '最大长度为64！'}
          }
        },
        'article[source_url]': {
          validators: {
            stringLength:{max: 128, message: '最大长度为128！'}
          }
        }
      }
    });

    $('.article_save_btn').click(function() {
      $articleForm.bootstrapValidator('validate');
      if(!$articleForm.data('bootstrapValidator').isValid()){
        return false;
      }
      $articleForm.submit();
      return false;
    });

    var $contentEditor = $articleForm.find('textarea[name=content]');

    $contentEditor.on('keydown', function(ev){
      if(ev.altKey && ev.keyCode == 83) {
        $.get('/articles/convert_html', {'content': $(this).val()}, function(res){
          $('.content-show').html(res.content);
        });
      }
      stopEventBubble(ev);
    });
  })
</script>
